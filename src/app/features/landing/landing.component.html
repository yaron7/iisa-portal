<!-- <div class="video-background">
  <video autoplay
         muted
         loop
         playsinline>
    <source src="assets/videos/earth-from-space.mp4"
            type="video/mp4" />
    Your browser does not support the video tag.
  </video>
</div> -->

<div class="overlay"></div>

<div class="content-container">

  @if (submissionSuccess) {
  <app-thank-you-card [canReEdit]="canReEdit"
                      [reEditExpiresDate]="reEditExpiresDate"
                      (editMySubmission)="editMySubmission()"
                      (returnHome)="resetState()" />

  } @else if (canReEdit && !hideReEditCard) {
  <app-re-edit-card [reEditExpiresDate]="reEditExpiresDate"
                    (beginApplication)="beginApplication()"
                    (editMySubmission)="editMySubmission()" />

  } @else {

  @if (formState === 'hidden') {
  <div class="hero-section">
    <h1>ISRAEL'S NEXT LEAP</h1>
    <p>
      The first Israeli public space flight is now open for registration. Start your journey to the stars.
    </p>
    <button mat-raised-button
            color="primary"
            class="cta-button"
            (click)="beginApplication()">
      BEGIN APPLICATION
    </button>
  </div>
  }

  @if (formState === 'visible') {
  <div class="form-container"
       [@formFade]="formState">
    <h2>Application Portal</h2>

    <mat-stepper orientation="vertical"
                 linear
                 #stepper>

      <mat-step [stepControl]="personalInfoForm">
        <form [formGroup]="personalInfoForm">
          <ng-template matStepLabel>Your Personal Details</ng-template>

          @for (field of personalFields; track field.name) {
          <mat-form-field>
            <mat-label>{{ field.label }}</mat-label>
            @if (field.name === 'fullName') {
            <input matInput
                   normalizeFullName
                   [type]="field.type"
                   [formControlName]="field.name" />
            } @else {
            <input matInput
                   [type]="field.type"
                   [formControlName]="field.name" />
            }
          </mat-form-field>
          }

          <mat-form-field>
            <mat-label>City or region</mat-label>
            <input matInput
                   formControlName="city"
                   placeholder="Start typing a city"
                   placesAutocomplete
                   [types]="['(cities)']"
                   [country]="['il']"
                   (placeSelected)="onCitySelected($event)" />
          </mat-form-field>

          <div>
            <button mat-button
                    matStepperNext>Next</button>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="freeTextForm">
        <form [formGroup]="freeTextForm">
          <ng-template matStepLabel>Tell Us About You</ng-template>

          <mat-form-field>
            <mat-label>Hobbies</mat-label>
            <textarea matInput
                      formControlName="hobbies"
                      rows="3"></textarea>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Why are you the perfect candidate?</mat-label>
            <textarea matInput
                      formControlName="perfectCandidateReason"
                      rows="5"></textarea>
          </mat-form-field>

          <div>
            <button mat-button
                    matStepperPrevious>Back</button>
            <button mat-button
                    matStepperNext>Next</button>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="imageForm">
        <form [formGroup]="imageForm">
          <ng-template matStepLabel>Upload Profile Image</ng-template>

          <div class="d-flex justify-content-center">
            <button mat-stroked-button
                    type="button"
                    (click)="fileInput.click()">
              <mat-icon>upload</mat-icon>
              Choose Image (JPEG/PNG)
            </button>
            <input #fileInput
                   hidden
                   type="file"
                   accept="image/png, image/jpeg"
                   (change)="onFileSelected($event)" />
          </div>

          @if (imagePreview) {
          <div class="image-preview">
            <img [src]="imagePreview"
                 alt="Image Preview" />
          </div>
          }

          <div class="mt-4">
            <button mat-button
                    matStepperPrevious>Back</button>
            <button mat-raised-button
                    color="primary"
                    (click)="onSubmit()"
                    [disabled]="isSubmitting">
              @if (!isSubmitting) { <span>Submit Final Application</span> }
              @else { <mat-progress-spinner diameter="20"
                                    mode="indeterminate"></mat-progress-spinner> }
            </button>
          </div>
        </form>
      </mat-step>

    </mat-stepper>
  </div>
  }
  }
</div>