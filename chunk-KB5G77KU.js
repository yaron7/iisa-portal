import{a as bt,b as _t,c as xt}from"./chunk-LJ5BKHVW.js";import{a as rt}from"./chunk-CABEAW7R.js";import{A as Ct,B as Mt,c as ct}from"./chunk-B6J6PNFU.js";import{a as ot}from"./chunk-YR2JDWSS.js";import{$ as lt,a as $,b as d,ca as dt,d as W,e as J,f as K,h as Q,ha as mt,i as X,j as Z,k as tt,l as et,la as st,m as it,na as pt,o as nt,oa as ft,p as at,pa as ut,qa as gt,ra as ht}from"./chunk-OWSZPSB2.js";import{V as F,c as G,h as H,l as Y,w as q}from"./chunk-VLRPGDCF.js";import{$ as N,Ac as j,Ca as T,Cb as b,Jb as C,L as w,Ob as _,R as y,S as k,Tb as a,Ub as n,Vb as s,Zb as L,bc as p,ca as D,cc as x,ib as S,la as u,lb as m,lc as A,mc as l,oc as z,p as v,qb as U,ua as g,v as E,va as h,vc as O,xb as V,yc as B,z as I,zb as R}from"./chunk-Q2JYTUQO.js";var P=class o{constructor(t){this.ngControl=t}onBlur(){let t=this.ngControl.control;if(t&&typeof t.value=="string"){let e=t.value.trim();e!==t.value&&t.setValue(e)}}static \u0275fac=function(e){return new(e||o)(U(W))};static \u0275dir=R({type:o,selectors:[["","trimInput",""]],hostBindings:function(e,i){e&1&&p("blur",function(){return i.onBlur()})}})};var St=()=>["(cities)"],Ot=()=>["il"];function Ft(o,t){o&1&&l(0," Edit Candidate ")}function Et(o,t){o&1&&l(0," New Candidate ")}function It(o,t){if(o&1&&(a(0,"span"),l(1),B(2,"date"),n()),o&2){let e=x(2);m(),z("on ",j(2,1,e.editUntil,"medium"),".")}}function kt(o,t){if(o&1&&(a(0,"div",2)(1,"strong",25),l(2,"Editing Locked:"),n(),a(3,"span",26),l(4," The 3-day edit window has expired "),b(5,It,3,4,"span"),l(6," You can view this submission, but editing is disabled. "),n()()),o&2){let e=x();m(5),_(e.editUntil?5:-1)}}function Nt(o,t){if(o&1&&s(0,"img",18),o&2){let e=x();C("src",e.imagePreview,S)}}function Dt(o,t){if(o&1&&s(0,"img",19),o&2){let e=x();C("src",e.existingProfileImageUrl,S)}}function Tt(o,t){o&1&&(a(0,"mat-icon"),l(1,"person"),n())}var Ut=3,vt=["fullName","email","phone","age","city","hobbies","perfectCandidateReason"],Pt=class o{id=null;candidateForm;imageFile=null;imagePreview=null;existingProfileImageUrl=null;isEditMode=!1;isLoading=!1;canEdit=!0;editUntil;candidateService=u(Mt);analyticsService=u(rt);fb=u(nt);router=u(q);location=u(G);destroyRef=u(T);originalCandidate=null;allowedFileFormat=["image/png","image/jpeg","image/jpg"];maxFileSize=5*1024*1024;originalSnapshot;get hasChanges(){if(!this.isEditMode||!this.originalSnapshot||this.imageFile)return!0;let t=this.snapshot();for(let e of vt)if(t?.[e]!==this.originalSnapshot?.[e])return!0;return!1}ngOnInit(){this.isEditMode=!!this.id,this.initForm(),this.isEditMode&&this.id&&(this.isLoading=!0,this.candidateService.getCandidateById(this.id).pipe(F(this.destroyRef),k(),D(t=>{if(!t)throw new Error("not-found");this.originalCandidate=t,this.candidateForm.patchValue(t),this.existingProfileImageUrl=t.profileImageUrl||null,this.originalSnapshot=Object.freeze(this.snapshot());let e=t.registrationDate??null,i=this.toMillisSafe(e);if(i){let r=new Date(i);r.setDate(r.getDate()+Ut),this.editUntil=r,this.canEdit=Date.now()<=r.getTime(),this.canEdit||this.candidateForm.disable({emitEvent:!1})}else this.canEdit=!0}),w(()=>(this.location.back(),v)),y(()=>{this.isLoading=!1})).subscribe())}initForm(){this.candidateForm=this.fb.group({fullName:["",[d.required,_t]],email:["",[d.required,d.email]],phone:["",[d.required,d.pattern(/^0(?:[23489]\d{7}|5\d{8})$/)]],age:[null,[d.required,d.min(18),d.max(99)]],city:["",d.required],cityLat:[null],cityLng:[null],hobbies:[""],perfectCandidateReason:["",d.required]})}normStr(t){return(typeof t=="string"?t.trim():"")||""}toMillisSafe(t){if(!t)return null;if(t instanceof Date)return t.getTime();if(t instanceof ot)return t.toMillis();if(typeof t=="number")return t;let e=new Date(t);return isNaN(e.getTime())?null:e.getTime()}snapshot(){let t=this.candidateForm.getRawValue();return{fullName:this.normStr(t.fullName),email:this.normStr(t.email),phone:this.normStr(t.phone),age:t.age,city:this.normStr(t.city),hobbies:this.normStr(t.hobbies),perfectCandidateReason:this.normStr(t.perfectCandidateReason)}}buildDiff(t){let e={};for(let i of vt){let r=t?.[i],c=this.originalSnapshot?.[i];r!==c&&(e[i]=r)}return e}onFileSelected(t){let e=t.target.files?.[0]||null;if(!e||!this.allowedFileFormat.includes(e.type)||e.size>this.maxFileSize)return;this.imageFile=e;let i=new FileReader;i.onload=()=>this.imagePreview=i.result,i.readAsDataURL(e)}onSubmit(){if(this.candidateForm.invalid){this.candidateForm.markAllAsTouched();return}if(this.isEditMode&&!this.canEdit){alert(`The 3-day edit window expired${this.editUntil?` on ${this.editUntil.toLocaleString()}`:""}.`);return}if(this.isEditMode&&!this.hasChanges)return;this.isLoading=!0,(this.imageFile?this.candidateService.uploadProfileImage(this.imageFile).pipe(I(e=>e)):E(this.existingProfileImageUrl)).pipe(N(e=>{let i=new Date;if(this.isEditMode&&this.id){let f=this.snapshot(),M=this.buildDiff(f);return e&&(M.profileImageUrl=e),M.lastUpdated=i,Object.keys(M).length===0?v:this.candidateService.updateCandidate(this.id,M)}let r=this.candidateForm.value,c={fullName:this.normStr(r.fullName),email:this.normStr(r.email),phone:this.normStr(r.phone),age:r.age,city:this.normStr(r.city),hobbies:this.normStr(r.hobbies),perfectCandidateReason:this.normStr(r.perfectCandidateReason),profileImageUrl:e??this.existingProfileImageUrl??"",registrationDate:i,lastUpdated:i};return this.candidateService.addCandidate(c)}),F(this.destroyRef),y(()=>{this.isLoading=!1}),w(()=>(this.location.back(),v))).subscribe({next:()=>{if(!this.isEditMode)try{this.analyticsService.incrementRegistrations()}catch{}this.location.back()}})}onCitySelected(t){this.candidateForm.patchValue({city:t.city||t.formattedAddress,cityLat:t.lat,cityLng:t.lng})}onCancel(){let t=sessionStorage.getItem("iisa_dashboard_active_tab");t&&sessionStorage.setItem("iisa_dashboard_active_tab",t),this.location.back()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=V({type:o,selectors:[["app-candidate-form"]],inputs:{id:"id"},decls:64,vars:9,consts:[["fileInput",""],[1,"page"],["role","alert","aria-live","polite",1,"alert-lock"],[3,"ngSubmit","formGroup"],[1,"form-grid"],["appearance","fill"],["matInput","","normalizeFullName","","trimInput","","formControlName","fullName"],["matInput","","trimInput","","formControlName","email","type","email"],[1,"span-2","row-3"],["appearance","fill",1,"col-span-2"],["matInput","","trimInput","","formControlName","phone"],["matInput","","formControlName","age","type","number","min","18","max","99"],["matInput","","formControlName","city","placesAutocomplete","",3,"placeSelected","types","country"],[1,"span-2","row-2"],["matInput","","formControlName","hobbies","rows","3","placeholder","Hobbies"],["matInput","","formControlName","perfectCandidateReason","rows","5","placeholder","Your answer"],[1,"upload"],[1,"preview"],["alt","Profile preview",3,"src"],["alt","Profile image",3,"src"],["mat-raised-button","","color","accent","type","button",3,"click"],["type","file","accept","image/png,image/jpeg","hidden","",3,"change"],[1,"d-flex","justify-content-between","mt-4"],["mat-button","",3,"click"],["mat-raised-button","","color","accent","type","submit",3,"disabled"],[1,"alert-lock__title"],[1,"alert-lock__text"]],template:function(e,i){if(e&1){let r=L();a(0,"div",1)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title"),b(4,Ft,1,0)(5,Et,1,0),n()(),a(6,"mat-card-content"),b(7,kt,7,1,"div",2),a(8,"form",3),p("ngSubmit",function(){return g(r),h(i.onSubmit())}),a(9,"div",4)(10,"mat-form-field",5)(11,"mat-label"),l(12,"Full Name"),n(),s(13,"input",6),n(),a(14,"mat-form-field",5)(15,"mat-label"),l(16,"Email"),n(),s(17,"input",7),n(),a(18,"div",8)(19,"mat-form-field",9)(20,"mat-label"),l(21,"Phone"),n(),s(22,"input",10),n(),a(23,"mat-form-field",5)(24,"mat-label"),l(25,"Age"),n(),s(26,"input",11),n(),a(27,"mat-form-field",5)(28,"mat-label"),l(29,"City or region"),n(),a(30,"input",12),p("placeSelected",function(f){return g(r),h(i.onCitySelected(f))}),n()()(),a(31,"div",13)(32,"mat-form-field",5)(33,"mat-label"),l(34,"Hobbies"),n(),s(35,"textarea",14),n(),a(36,"mat-form-field",5)(37,"mat-label"),l(38,"Why I am the perfect candidate"),n(),s(39,"textarea",15),n()()(),a(40,"div",16)(41,"div",17),b(42,Nt,1,1,"img",18)(43,Dt,1,1,"img",19)(44,Tt,2,0,"mat-icon"),n(),a(45,"div")(46,"button",20),p("click",function(){g(r);let f=A(52);return h(f.click())}),a(47,"mat-icon"),l(48,"upload"),n(),l(49," Upload Profile Image "),n(),a(50,"div")(51,"input",21,0),p("change",function(f){return g(r),h(i.onFileSelected(f))}),n(),a(53,"small"),l(54,"Accepted: JPG/PNG, up to 5MB"),n()()()(),a(55,"mat-card-actions",22)(56,"button",23),p("click",function(){return g(r),h(i.onCancel())}),a(57,"mat-icon"),l(58,"arrow_back"),n(),l(59," Back "),n(),a(60,"button",24)(61,"mat-icon"),l(62,"save"),n(),l(63," Save "),n()()()()()()}e&2&&(m(4),_(i.isEditMode?4:5),m(3),_(i.isEditMode&&!i.canEdit?7:-1),m(),C("formGroup",i.candidateForm),m(22),C("types",O(7,St))("country",O(8,Ot)),m(12),_(i.imagePreview?42:i.existingProfileImageUrl?43:44),m(18),C("disabled",i.candidateForm.invalid||i.isLoading||i.isEditMode&&(!i.canEdit||!i.hasChanges)))},dependencies:[Y,H,at,Q,$,X,J,K,it,et,Z,tt,Ct,lt,st,mt,dt,pt,gt,ut,ht,ft,ct,bt,xt,P],styles:["[_nghost-%COMP%]{display:block}.page[_ngcontent-%COMP%]{max-width:980px;margin:0 auto;padding:16px}mat-card[_ngcontent-%COMP%]{background:#0f1e3cf2;border:1px solid rgba(160,192,255,.28);border-radius:14px;color:#e0f2f7;box-shadow:0 18px 60px #0000008c;animation:_ngcontent-%COMP%_fadeInUp .6s ease-out}mat-card-header[_ngcontent-%COMP%]{border-bottom:1px solid rgba(255,255,255,.08);padding:16px 20px}mat-card-title[_ngcontent-%COMP%], mat-card-subtitle[_ngcontent-%COMP%]{font-family:Orbitron,sans-serif;letter-spacing:.03em}mat-card-title[_ngcontent-%COMP%]{color:#a0c0ff;font-size:1.35rem}mat-card-content[_ngcontent-%COMP%]{padding:20px}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:16px}.row-3[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;width:100%}.row-3[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.row-3[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%], .row-3[_ngcontent-%COMP%]   .mdc-text-field[_ngcontent-%COMP%]{width:100%;height:auto;display:flex;align-items:center}.row-2[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr;align-items:stretch}.span-2[_ngcontent-%COMP%]{grid-column:1 / -1}mat-form-field[_ngcontent-%COMP%]{width:100%}.mat-mdc-form-field-subscript-wrapper[_ngcontent-%COMP%], .mat-mdc-form-field-hint-wrapper[_ngcontent-%COMP%]{color:#cfe0ff}.mdc-text-field--filled[_ngcontent-%COMP%]   .mdc-line-ripple[_ngcontent-%COMP%]:after{border-bottom-color:#a0c0ff}.mdc-text-field[_ngcontent-%COMP%]:not(.mdc-text-field--disabled)   .mdc-text-field__input[_ngcontent-%COMP%]{color:#e6eefc}.mdc-text-field__input[_ngcontent-%COMP%]::placeholder{color:#e6eefc99}.mdc-text-field--filled[_ngcontent-%COMP%]{background-color:#ffffff08}.mdc-text-field--filled[_ngcontent-%COMP%]   .mdc-notched-outline__leading[_ngcontent-%COMP%], .mdc-text-field--filled[_ngcontent-%COMP%]   .mdc-notched-outline__trailing[_ngcontent-%COMP%], .mdc-notched-outline__notch[_ngcontent-%COMP%]{border-color:#a0c0ff2e}textarea[matInput][_ngcontent-%COMP%]{min-height:120px}.upload[_ngcontent-%COMP%]{display:grid;grid-template-columns:140px 1fr;gap:16px;align-items:center}.preview[_ngcontent-%COMP%]{width:120px;height:120px;border-radius:12px;overflow:hidden;border:1px solid rgba(160,192,255,.28);box-shadow:0 6px 18px #00000059;background:#ffffff08;display:grid;place-items:center}.preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}button[mat-raised-button][_ngcontent-%COMP%]{border-radius:22px;font-weight:600;letter-spacing:.02em;box-shadow:0 0 16px #a0c0ff40;transition:transform .2s ease,box-shadow .2s ease}button[mat-raised-button][_ngcontent-%COMP%]:disabled{opacity:.45;cursor:not-allowed;pointer-events:none;filter:grayscale(40%) contrast(85%);transform:scale(.98);transition:opacity .2s ease-in-out,filter .2s ease-in-out,transform .2s ease-in-out,background-color .2s ease-in-out;background-color:#80808033!important;color:#ffffffb3!important;box-shadow:none!important;backdrop-filter:blur(2px)}button[mat-raised-button][_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 0 24px #a0c0ff73}button[color=accent][_ngcontent-%COMP%]{color:#0b1020;background-color:#a0c0ff}button.mat-mdc-button[_ngcontent-%COMP%], button.mat-mdc-unelevated-button[_ngcontent-%COMP%], button.mat-mdc-raised-button[_ngcontent-%COMP%]{letter-spacing:.05em}button.mat-mdc-unelevated-button.mat-accent[_ngcontent-%COMP%], button.mat-mdc-raised-button.mat-accent[_ngcontent-%COMP%]{color:#212121;background-color:#a0c0ff;box-shadow:0 4px 16px #f7e7334d}button.mat-mdc-unelevated-button.mat-accent[_ngcontent-%COMP%]:hover, button.mat-mdc-raised-button.mat-accent[_ngcontent-%COMP%]:hover{background-color:#c4dbff;box-shadow:0 0 15px #a0c0ff99;transition:all .3s ease}button.mat-mdc-button[_ngcontent-%COMP%]{color:#a0c0ff!important}button.mat-mdc-button[_ngcontent-%COMP%]:hover{color:#c4dbff!important;text-shadow:0 0 15px rgba(160,192,255,.6)}button[color=warn][_ngcontent-%COMP%]{background-color:#ff6f6f}.alert-lock[_ngcontent-%COMP%]{margin-bottom:12px;padding:12px 14px;border:1px solid rgba(255,255,255,.2);border-radius:10px;background:#ff634714;color:#ffb3a8;font-size:.95rem;display:flex;gap:8px;align-items:baseline}.alert-lock__title[_ngcontent-%COMP%]{font-weight:700;letter-spacing:.2px}.alert-lock__text[_ngcontent-%COMP%]{line-height:1.4}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 768px){.page[_ngcontent-%COMP%]{padding:12px}.form-grid[_ngcontent-%COMP%], .upload[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:12px}.preview[_ngcontent-%COMP%]{width:96px;height:96px;margin:0 auto}}"]})};export{Pt as CandidateFormComponent};
