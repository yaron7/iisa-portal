import{a as pt,b as ft,c as gt}from"./chunk-UVQFYTA5.js";import{a as tt}from"./chunk-ZY6XP4WM.js";import{A as st,a as Z,d as ot}from"./chunk-6BDKQN3U.js";import"./chunk-W74OV75A.js";import{$ as et,a as j,b as d,ca as it,e as R,f as q,h as B,ha as nt,i as Y,j as H,k as W,l as J,la as at,m as K,na as rt,o as Q,oa as dt,p as X,pa as lt,qa as mt,ra as ct}from"./chunk-OHTKK6G5.js";import{h as $,l as z,w as G}from"./chunk-WJAPHO4V.js";import{$ as k,Ac as A,Cb as b,Jb as u,Ob as h,Tb as a,Ub as t,Vb as m,Zb as U,a as v,aa as w,b as S,bc as _,c as P,cc as x,ib as O,k as E,la as C,lb as l,lc as V,mc as o,oc as T,ua as f,v as I,va as g,vc as y,xb as N,yc as L,z as D}from"./chunk-FXQC5WQD.js";var Ct=()=>["(cities)"],bt=()=>["il"];function ht(r,e){r&1&&o(0," Edit Candidate ")}function xt(r,e){r&1&&o(0," New Candidate ")}function Mt(r,e){if(r&1&&(a(0,"span"),o(1),L(2,"date"),t()),r&2){let i=x(2);l(),T("on ",A(2,1,i.editUntil,"medium"),".")}}function vt(r,e){if(r&1&&(a(0,"div",2)(1,"strong",25),o(2,"Editing Locked:"),t(),a(3,"span",26),o(4," The 3-day edit window has expired "),b(5,Mt,3,4,"span"),o(6," You can view this submission, but editing is disabled. "),t()()),r&2){let i=x();l(5),h(i.editUntil?5:-1)}}function Pt(r,e){if(r&1&&m(0,"img",18),r&2){let i=x();u("src",i.imagePreview,O)}}function wt(r,e){if(r&1&&m(0,"img",19),r&2){let i=x();u("src",i.existingProfileImageUrl,O)}}function Ot(r,e){r&1&&(a(0,"mat-icon"),o(1,"person"),t())}var yt=3,ut=class r{id=null;candidateForm;imageFile=null;imagePreview=null;existingProfileImageUrl=null;isEditMode=!1;isLoading=!1;canEdit=!0;editUntil;candidateService=C(Z);analyticsService=C(tt);fb=C(Q);router=C(G);destroy$=new E;originalCandidate=null;allowedFileFormat=["image/png","image/jpeg","image/jpg"];maxFileSize=5*1024*1024;ngOnInit(){this.isEditMode=!!this.id,this.initForm(),this.isEditMode&&this.id&&(this.isLoading=!0,this.candidateService.getCandidateById(this.id).pipe(w(this.destroy$)).subscribe({next:e=>{if(e){this.originalCandidate=e,this.candidateForm.patchValue(e),this.existingProfileImageUrl=e.profileImageUrl||null;let i=e.registrationDate?new Date(e.registrationDate):null;if(i){let n=new Date(i);n.setDate(n.getDate()+yt),this.editUntil=n,this.canEdit=new Date<=n,this.canEdit||this.candidateForm.disable()}else this.canEdit=!0}else this.router.navigate(["/dashboard"]);this.isLoading=!1},error:()=>{this.isLoading=!1,this.router.navigate(["/dashboard"])}}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initForm(){this.candidateForm=this.fb.group({fullName:["",d.required,ft],email:["",[d.required,d.email]],phone:["",[d.required,d.pattern(/^0(?:[23489]\d{7}|5\d{8})$/)]],age:[null,[d.required,d.min(18),d.max(99)]],city:["",d.required],cityLat:[null],cityLng:[null],hobbies:[""],perfectCandidateReason:["",d.required]})}onFileSelected(e){let i=e.target.files?.[0]||null;if(!i||!this.allowedFileFormat.includes(i.type)||i.size>this.maxFileSize)return;this.imageFile=i;let n=new FileReader;n.onload=()=>this.imagePreview=n.result,n.readAsDataURL(i)}onSubmit(){if(this.isEditMode&&!this.canEdit){alert(`The 3-day edit window expired${this.editUntil?` on ${this.editUntil.toLocaleString()}`:""}.`);return}if(this.candidateForm.invalid){this.candidateForm.markAllAsTouched();return}this.isLoading=!0,(this.imageFile?this.candidateService.uploadProfileImage(this.imageFile).pipe(D(i=>i)):I(this.existingProfileImageUrl)).pipe(k(i=>{let n=this.candidateForm.value,c=new Date,p=S(v(v({},this.originalCandidate),n),{profileImageUrl:i||"",lastUpdated:c,registrationDate:this.isEditMode?this.originalCandidate?.registrationDate:c});if(this.isEditMode&&this.id){let s=p,{id:_t}=s,M=P(s,["id"]);return this.candidateService.updateCandidate(this.id,M)}else{let F=p,{id:_t}=F,M=P(F,["id"]);return this.candidateService.addCandidate(M)}}),w(this.destroy$)).subscribe({next:i=>{if(!this.isEditMode)try{this.analyticsService.incrementRegistrations()}catch{}this.isLoading=!1,this.router.navigate(["/dashboard"])},error:()=>{this.isLoading=!1}})}onCitySelected(e){this.candidateForm.patchValue({city:e.city||e.formattedAddress,cityLat:e.lat,cityLng:e.lng})}onCancel(){let e=sessionStorage.getItem("iisa_dashboard_active_tab");this.router.navigate(["/dashboard"]).then(()=>{e&&sessionStorage.setItem("iisa_dashboard_active_tab",e)})}static \u0275fac=function(i){return new(i||r)};static \u0275cmp=N({type:r,selectors:[["app-candidate-form"]],inputs:{id:"id"},decls:64,vars:9,consts:[["fileInput",""],[1,"page"],["role","alert","aria-live","polite",1,"alert-lock"],[3,"ngSubmit","formGroup"],[1,"form-grid"],["appearance","fill"],["matInput","","normalizeFullName","","formControlName","fullName"],["matInput","","formControlName","email","type","email"],[1,"span-2","row-3"],["appearance","fill",1,"col-span-2"],["matInput","","formControlName","phone"],["matInput","","formControlName","age","type","number","min","18","max","99"],["matInput","","formControlName","city","appPlacesAutocomplete","",3,"placeSelected","types","country"],[1,"span-2","row-2"],["matInput","","formControlName","hobbies","rows","3","placeholder","Hobbies"],["matInput","","formControlName","perfectCandidateReason","rows","5","placeholder","Your answer"],[1,"upload"],[1,"preview"],["alt","Profile preview",3,"src"],["alt","Profile image",3,"src"],["mat-raised-button","","color","accent","type","button",3,"click"],["type","file","accept","image/png,image/jpeg","hidden","",3,"change"],[1,"d-flex","justify-content-between","mt-4"],["mat-button","",3,"click"],["mat-raised-button","","color","accent","type","submit",3,"disabled"],[1,"alert-lock__title"],[1,"alert-lock__text"]],template:function(i,n){if(i&1){let c=U();a(0,"div",1)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title"),b(4,ht,1,0)(5,xt,1,0),t()(),a(6,"mat-card-content"),b(7,vt,7,1,"div",2),a(8,"form",3),_("ngSubmit",function(){return f(c),g(n.onSubmit())}),a(9,"div",4)(10,"mat-form-field",5)(11,"mat-label"),o(12,"Full Name"),t(),m(13,"input",6),t(),a(14,"mat-form-field",5)(15,"mat-label"),o(16,"Email"),t(),m(17,"input",7),t(),a(18,"div",8)(19,"mat-form-field",9)(20,"mat-label"),o(21,"Phone"),t(),m(22,"input",10),t(),a(23,"mat-form-field",5)(24,"mat-label"),o(25,"Age"),t(),m(26,"input",11),t(),a(27,"mat-form-field",5)(28,"mat-label"),o(29,"City or region"),t(),a(30,"input",12),_("placeSelected",function(s){return f(c),g(n.onCitySelected(s))}),t()()(),a(31,"div",13)(32,"mat-form-field",5)(33,"mat-label"),o(34,"Hobbies"),t(),m(35,"textarea",14),t(),a(36,"mat-form-field",5)(37,"mat-label"),o(38,"Why I am the perfect candidate"),t(),m(39,"textarea",15),t()()(),a(40,"div",16)(41,"div",17),b(42,Pt,1,1,"img",18)(43,wt,1,1,"img",19)(44,Ot,2,0,"mat-icon"),t(),a(45,"div")(46,"button",20),_("click",function(){f(c);let s=V(52);return g(s.click())}),a(47,"mat-icon"),o(48,"upload"),t(),o(49," Upload Profile Image "),t(),a(50,"div")(51,"input",21,0),_("change",function(s){return f(c),g(n.onFileSelected(s))}),t(),a(53,"small"),o(54,"Accepted: JPG/PNG, up to 5MB"),t()()()(),a(55,"mat-card-actions",22)(56,"button",23),_("click",function(){return f(c),g(n.onCancel())}),a(57,"mat-icon"),o(58,"arrow_back"),t(),o(59," Back to Dashboard "),t(),a(60,"button",24)(61,"mat-icon"),o(62,"save"),t(),o(63," Save "),t()()()()()()}i&2&&(l(4),h(n.isEditMode?4:5),l(3),h(n.isEditMode&&!n.canEdit?7:-1),l(),u("formGroup",n.candidateForm),l(22),u("types",y(7,Ct))("country",y(8,bt)),l(12),h(n.imagePreview?42:n.existingProfileImageUrl?43:44),l(18),u("disabled",n.candidateForm.invalid||n.isLoading||n.isEditMode&&!n.canEdit))},dependencies:[z,$,X,B,j,Y,R,q,K,J,H,W,st,et,at,nt,it,rt,mt,lt,ct,dt,ot,pt,gt],styles:["[_nghost-%COMP%]{display:block}.page[_ngcontent-%COMP%]{max-width:980px;margin:0 auto;padding:16px}mat-card[_ngcontent-%COMP%]{background:#0f1e3cf2;border:1px solid rgba(160,192,255,.28);border-radius:14px;color:#e0f2f7;box-shadow:0 18px 60px #0000008c;animation:_ngcontent-%COMP%_fadeInUp .6s ease-out}mat-card-header[_ngcontent-%COMP%]{border-bottom:1px solid rgba(255,255,255,.08);padding:16px 20px}mat-card-title[_ngcontent-%COMP%], mat-card-subtitle[_ngcontent-%COMP%]{font-family:Orbitron,sans-serif;letter-spacing:.03em}mat-card-title[_ngcontent-%COMP%]{color:#a0c0ff;font-size:1.35rem}mat-card-content[_ngcontent-%COMP%]{padding:20px}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:16px}.row-3[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;width:100%}.row-3[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.row-3[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%], .row-3[_ngcontent-%COMP%]   .mdc-text-field[_ngcontent-%COMP%]{width:100%;height:auto;display:flex;align-items:center}.row-2[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr;align-items:stretch}.span-2[_ngcontent-%COMP%]{grid-column:1 / -1}mat-form-field[_ngcontent-%COMP%]{width:100%}.mat-mdc-form-field-subscript-wrapper[_ngcontent-%COMP%], .mat-mdc-form-field-hint-wrapper[_ngcontent-%COMP%]{color:#cfe0ff}.mdc-text-field--filled[_ngcontent-%COMP%]   .mdc-line-ripple[_ngcontent-%COMP%]:after{border-bottom-color:#a0c0ff}.mdc-text-field[_ngcontent-%COMP%]:not(.mdc-text-field--disabled)   .mdc-text-field__input[_ngcontent-%COMP%]{color:#e6eefc}.mdc-text-field__input[_ngcontent-%COMP%]::placeholder{color:#e6eefc99}.mdc-text-field--filled[_ngcontent-%COMP%]{background-color:#ffffff08}.mdc-text-field--filled[_ngcontent-%COMP%]   .mdc-notched-outline__leading[_ngcontent-%COMP%], .mdc-text-field--filled[_ngcontent-%COMP%]   .mdc-notched-outline__trailing[_ngcontent-%COMP%], .mdc-notched-outline__notch[_ngcontent-%COMP%]{border-color:#a0c0ff2e}textarea[matInput][_ngcontent-%COMP%]{min-height:120px}.upload[_ngcontent-%COMP%]{display:grid;grid-template-columns:140px 1fr;gap:16px;align-items:center}.preview[_ngcontent-%COMP%]{width:120px;height:120px;border-radius:12px;overflow:hidden;border:1px solid rgba(160,192,255,.28);box-shadow:0 6px 18px #00000059;background:#ffffff08;display:grid;place-items:center}.preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}button[mat-raised-button][_ngcontent-%COMP%]{border-radius:22px;font-weight:600;letter-spacing:.02em;box-shadow:0 0 16px #a0c0ff40;transition:transform .2s ease,box-shadow .2s ease}button[mat-raised-button][_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 0 24px #a0c0ff73}button[color=accent][_ngcontent-%COMP%]{color:#0b1020;background-color:#a0c0ff}button.mat-mdc-button[_ngcontent-%COMP%], button.mat-mdc-unelevated-button[_ngcontent-%COMP%], button.mat-mdc-raised-button[_ngcontent-%COMP%]{letter-spacing:.05em}button.mat-mdc-unelevated-button.mat-accent[_ngcontent-%COMP%], button.mat-mdc-raised-button.mat-accent[_ngcontent-%COMP%]{color:#212121;background-color:#a0c0ff;box-shadow:0 4px 16px #f7e7334d}button.mat-mdc-unelevated-button.mat-accent[_ngcontent-%COMP%]:hover, button.mat-mdc-raised-button.mat-accent[_ngcontent-%COMP%]:hover{background-color:#c4dbff;box-shadow:0 0 15px #a0c0ff99;transition:all .3s ease}button.mat-mdc-button[_ngcontent-%COMP%]{color:#a0c0ff!important}button.mat-mdc-button[_ngcontent-%COMP%]:hover{color:#c4dbff!important;text-shadow:0 0 15px rgba(160,192,255,.6)}button[color=warn][_ngcontent-%COMP%]{background-color:#ff6f6f}.alert-lock[_ngcontent-%COMP%]{margin-bottom:12px;padding:12px 14px;border:1px solid rgba(255,255,255,.2);border-radius:10px;background:#ff634714;color:#ffb3a8;font-size:.95rem;display:flex;gap:8px;align-items:baseline}.alert-lock__title[_ngcontent-%COMP%]{font-weight:700;letter-spacing:.2px}.alert-lock__text[_ngcontent-%COMP%]{line-height:1.4}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 768px){.page[_ngcontent-%COMP%]{padding:12px}.form-grid[_ngcontent-%COMP%], .upload[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:12px}.preview[_ngcontent-%COMP%]{width:96px;height:96px;margin:0 auto}}"]})};export{ut as CandidateFormComponent};
